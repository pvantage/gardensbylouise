<!doctype html>
<html lang="en">
<head>
<title>Gardens By Louise LLC</title>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<link rel="stylesheet" href="css/fonts-styles.css">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/jquery-ui.css">
<link rel="stylesheet" href="css/mycss.css">
</head>
<body class="light-grey-bg after-login schlbody">
<!----- Header Top ----->
<div class="container mysch-fix-hdr">
  <div class="header-top">
    <div class="row  align-items-center">
	<img src="images/hdr-logo.png" alt="header-logo" />
    </div>
  </div>
</div>
<!----- /Header Top ----->
<input type="hidden" id="job_id" value="0" />
<div class="clearfix"></div>
<div class="container cntbox tab-content timerbx">
  <div id="home" class="tab-pane fade in active show">
    <h1 class="myschle">Today's Timesheet</h1>
   
	<div class="start_list">
	<ul class="starttodayjob_times">
		<li><label>General Clock:</label><span class="general_clock_time" data-real-time=""></span></li>
		<li><label>Job Clock:</label><span class="job_clock_time" data-real-time=""></span></li>
	</ul>
	<button class="str-job starttodayjob"></button>
	<div class="clearfix"></div>
	<div class="startjob_status_text offclock_st_color"></div>
	<div class="previous_notes"></div>
	</div>
  </div>
  
</div>
<!----- Bottom Nav Bar ----->
<div class="bottom-nav-bar"></div>
<!----- /Bottom Nav Bar -----> 

<!-- Optional JavaScript --> 
<!-- jQuery first, then Popper.js, then Bootstrap JS --> 

<div id="myModal1" class="modal fade bottom-popup" role="dialog">
  <div class="modal-dialog"> 
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body">
        <div class="pop-cnt">
          <div class="pop-btm-cnt">
            <ul>
              <li class="nojobexist"><a href="javascript:;" class="accept_job">Accept</a></li>
            </ul>
          </div>
          <div class="pop-btm-cnt pop-cancel">
            <ul>
              <li> <a class="decline_job" href="javascript:;">Decline</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="myModal2" class="modal fade bottom-popup" role="dialog">
  <div class="modal-dialog"> 
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body">
        <div class="pop-cnt">
          <div class="pop-btm-cnt">
            <ul>
              <li class="nojobexist"><a href="javascript:;" class="step2_newxt_job">Travel to next job</a></li>
			  <li><a href="javascript:;" class="step2_stopclocks">Clock out for day</a></li>
			  <li><a href="javascript:;" class="step2_stop_for_lunch">Clock out for lunch</a></li>
            </ul>
          </div>
          <div class="pop-btm-cnt pop-cancel">
            <ul>
              <li> <a href="javascript:;" data-dismiss="modal">Cancel</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="myModal3" class="modal fade bottom-popup" role="dialog">
  <div class="modal-dialog"> 
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body">
        <div class="pop-cnt">
          <div class="pop-btm-cnt">
            <ul>
              <li class="nojobexist"><a href="javascript:;" class="step3_newxt_job">Clock in to job</a></li>
			  <li><a href="javascript:;" class="step2_stopclocks">Clock out for day</a></li>
			  <li><a href="javascript:;" class="step2_stop_for_lunch">Clock out for lunch</a></li>
            </ul>
          </div>
          <div class="pop-btm-cnt pop-cancel">
            <ul>
              <li> <a href="javascript:;" data-dismiss="modal">Cancel</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="addnewnotes" class="modal fade popupformats taskpopup" role="dialog">
  <div class="modal-dialog"> 
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body">
        <div class="pop-head">
          <div class="row">
            <a href="javascript:;" data-dismiss="modal">Cancel</a>
            <div class="col-10 pop-title">Add Notes</div>
          </div>
        </div>
        <div class="new-forms-formats">
			<form id="noteform" name="noteform" action="" method="post">
			
		  <div class="nf-box">
			<textarea name="notemsg" id="notemsg" rows="3" cols="50" class="required forminput"></textarea>
          </div>
          <div class="nf-box">
           <button class="nf-box-btn savenewnote" type="button">Save</button>
          </div>
          
		  </form>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="addjobform" class="modal fade popupformats taskpopup" role="dialog">
  <div class="modal-dialog"> 
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body">
        <div class="pop-head">
          <div class="row">
            <a href="javascript:;" data-dismiss="modal">Cancel</a>
            <div class="col-10 pop-title">Form</div>
          </div>
        </div>
        <div class="new-forms-formats">
			<form id="jobform" name="jobform" action="" method="post">
			  <div class="nf-box">
			  	<label>Notes</label>
				<textarea name="notemsg" rows="3" cols="50" class="forminput"></textarea>
			  </div>
			  <div class="nf-box">
				<label>Bags of mulch used</label>
				<input type="number" class="forminput" name="bags_of_mulch_used" min="0" value="0" />
			  </div>
			  <div class="nf-box">
				<label>Bag size</label>
				<input type="number" class="forminput" name="mulch_bag_size" min="0" value="0" />
			  </div>
			   <div class="nf-box">
				<label>Bags of compost used</label>
				<input type="number" class="forminput" name="bags_of_compost_used" min="0" value="0" />
			  </div>
			  <div class="nf-box">
				<label>Bag size</label>
				<input type="number" class="forminput" name="compost_bag_size" min="0" value="0" />
			  </div>
			  <div class="nf-box">
				<label>Bags of Holly Tone used</label>
				<input type="number" class="forminput" name="bags_of_holly_tone_used" min="0" value="0" />
			  </div>
			  <div class="nf-box">
				<label>Bag size</label>
				<input type="number" class="forminput" name="holly_tone_bag_size" min="0" value="0" />
			  </div>
			  <div class="nf-box">
				<label>Are you leaving a wheelbarrow?</label>
				<div class="form-radios">
				  <label>
					<input value="Yes" type="radio" name="leaving_a_wheelbarrow" />
					Yes</label>
				  <label>
					<input value="No" type="radio" name="leaving_a_wheelbarrow" />
					No</label>
				</div>
			  </div>
			  <div class="nf-box">
				<label>Bags of debris</label>
				<input type="number" class="forminput" name="bags_of_debris" min="0" value="0" />
			  </div>
			  <div class="nf-box">
				<label>Any issues with bees, plants/bushes not doing well, poison ivy? Put details in Notes</label>
				<div class="form-radios">
				  <label>
					<input value="Yes" type="radio" name="problem_with_bees_plants_bushes" />
					Yes</label>
				  <label>
					<input value="No" type="radio" name="problem_with_bees_plants_bushes" />
					No</label>
				</div>
			  </div>
			  <div class="nf-box">
				<label>Any messages from homeowner? Put details in Notes</label>
				<div class="form-radios">
				  <label>
					<input value="Yes" type="radio" name="messages_from_homeowner" />
					Yes</label>
				  <label>
					<input value="No" type="radio" name="messages_from_homeowner" />
					No</label>
				</div>
			  </div>
			  <div class="nf-box">
				<label>If there is work still to be done, estimate how much is left in hours</label>
				<input type="number" class="forminput" name="pending_task_time" min="0" value="0" />
			  </div>
			  <div class="nf-box">
				<label>If additional materials are needed, provide details in Notes</label>
				<div class="form-radios">
				  <label>
					<input value="Yes" type="radio" name="additional_materials_are_needed" />
					Yes</label>
				  <label>
					<input value="No" type="radio" name="additional_materials_are_needed" />
					No</label>
				</div>
			  </div>
			  <div class="nf-box">
				<label>How much of your time was spent planting?</label>
				<input type="number" class="forminput" name="time_spent_planting" min="0" value="0" />
			  </div>
			  <div class="nf-box">
				<button class="nf-box-btn savenejobform" type="button">Done</button>
			  </div>
          
		  </form>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="js/jquery-3.2.1.min.js" ></script> 

<script src="js/jquery-ui.min.js" ></script>
<script src="js/popper.min.js" ></script> 
<script src="js/bootstrap.min.js" ></script>
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script type="text/javascript" src="js/config.js"></script>
<script type="text/javascript" src="js/database.js"></script>
<script type="text/javascript">

var timecount=0;
var counter='';
var timecount2=0;
var counter2='';
function gettimediff(time1,time2){
	var tms=time1.split(' ');
	var ds=tms[0].split('-');
	var ts=tms[1].split(':');
	time1=ds[1]+'/'+ds[2]+'/'+ds[0]+' '+tms[1];
	
	var tms=time2.split(' ');
	var ds=tms[0].split('-');
	var ts=tms[1].split(':');
	time2=ds[1]+'/'+ds[2]+'/'+ds[0]+' '+tms[1];
	var date1 = new Date(time1);
	var date2 = new Date(time2);
	var diff = date2.getTime() - date1.getTime();
	var msec = parseInt(diff);
	var hh = Math.floor(msec / 1000 / 60 / 60);
	msec -= hh * 1000 * 60 * 60;
	var mm = Math.floor(msec / 1000 / 60);
	msec -= mm * 1000 * 60;
	var ss = Math.floor(msec / 1000);
	msec -= ss * 1000;
	
	if(parseInt(hh)<10){hh='0'+hh;}
	if(parseInt(mm)<10){mm='0'+mm;}
	if(parseInt(ss)<10){ss='0'+ss;}
	return hh + ":" + mm + ":" + ss;
}
function generaltimer(){
	var playcounter=true;
	var stop_general_clock=localStorage.getItem('stop_general_clock_'+today);
	
	if(typeof stop_general_clock!='undefined' && stop_general_clock=='stop'){
		clearInterval(counter);
		playcounter=false;
	}
	if(playcounter)
	{
		timecount=parseInt(timecount)+1000;
		timecount=parseInt(timecount);
		var hours = Math.floor((timecount % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
		var minutes = Math.floor((timecount % (1000 * 60 * 60)) / (1000 * 60));
		var seconds = Math.floor((timecount % (1000 * 60)) / 1000);
		if(parseInt(hours)<10){hours='0'+parseInt(hours);}
		if(parseInt(minutes)<10){minutes='0'+parseInt(minutes);}
		if(parseInt(seconds)<10){seconds='0'+parseInt(seconds);}
		var waittime=hours+':'+minutes+':'+seconds;
		jQuery('.general_clock_time').html(waittime);
		localStorage.setItem('general_'+today,waittime);
		localStorage.setItem('timecount',timecount);
	}
	
	
}
function jobtimer(){
	var playcounter=true;
	var stop_job_clock=localStorage.getItem('stop_job_clock_'+today);
	if(typeof stop_job_clock!='undefined' && stop_job_clock=='stop'){
		clearInterval(counter2);
		playcounter=false;
	}
	if(playcounter)
	{
		timecount2=parseInt(timecount2)+1000;
		timecount2=parseInt(timecount2);
		var hours = Math.floor((timecount2 % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
		var minutes = Math.floor((timecount2 % (1000 * 60 * 60)) / (1000 * 60));
		var seconds = Math.floor((timecount2 % (1000 * 60)) / 1000);
		if(parseInt(hours)<10){hours='0'+parseInt(hours);}
		if(parseInt(minutes)<10){minutes='0'+parseInt(minutes);}
		if(parseInt(seconds)<10){seconds='0'+parseInt(seconds);}
		var waittime=hours+':'+minutes+':'+seconds;
		jQuery('.job_clock_time').html(waittime);
		localStorage.setItem('job_'+today,waittime);
		localStorage.setItem('timecount2',timecount2);
	}
	
}
function loadjob(job_id){
	var job_id2=localStorage.getItem('finish_job');
	if(job_id!=job_id2){
		var currentdatetime=getdatetime();
		var currenttime=getcurrenttime();
		db.transaction(showlistjobs, errorDB, successDB);
		function showlistjobs(tx){
			var q="SELECT * FROM jobs WHERE job_id=? AND user_id=?";
			var cond=[job_id,uid];
			tx.executeSql(q, cond, function(tx, res){
				if(parseInt(res.rows.length)>0){
					for(var i = 0; i < res.rows.length; i++)
					{
						if(res.rows.item(i).status=='Assigned'){
							tx.executeSql("UPDATE jobs set status='Being Processed', real_date='"+today+"', real_start_time='"+currenttime+"' WHERE job_id='"+job_id+"' AND user_id='"+uid+"'");
							tx.executeSql("UPDATE job_daytimes set job_id='"+job_id+"' WHERE start_date='"+today+"' AND user_id='"+uid+"'");
							tx.executeSql('INSERT INTO job_times (job_id, assigned_to, pu_date, start_time, time_type, cdate) VALUES ("'+job_id+'", "'+uid+'","'+today+'", "'+currenttime+'","startjob", "'+currentdatetime+'")');
							
							var q2="SELECT * FROM job_schedule WHERE job_date=? AND user_id=?";
							var cond2=[today,uid];
							tx.executeSql(q2, cond2, function(tx, res2){
								if(parseInt(res2.rows.length)>0){
									var last_job_id=res2.rows.item(parseInt(res2.rows.length)-1).job_id;
									tx.executeSql('INSERT INTO job_schedule (job_id, startfrom, job_date, last_job_id, user_id, cdate) VALUES ("'+job_id+'", "job","'+today+'", "'+last_job_id+'", "'+uid+'", "'+currentdatetime+'")');
								}
								else{
									
									tx.executeSql('INSERT INTO job_schedule (job_id, startfrom, job_date, last_job_id, user_id, cdate) VALUES ("'+job_id+'", "office","'+today+'", "0", "'+uid+'", "'+currentdatetime+'")');
								}
							});
							localStorage.removeItem('stop_job_clock_'+today);
							localStorage.removeItem('stop_general_clock_'+today);
							localStorage.removeItem('finish_job');
						}
						jQuery('.previous_notes').html('<button type="button" class="nf-box-btn" data-toggle="modal" data-target="#addnewnotes">Add Note</button>');
						var q="SELECT * FROM job_notifications WHERE job_id=? AND title=? ORDER BY cdate DESC";
						var cond=[job_id,'Note'];
						tx.executeSql(q, cond, function(tx, res2){
							if(parseInt(res2.rows.length)>0){
								var html='<button type="button" class="nf-box-btn" data-toggle="modal" data-target="#addnewnotes">Add Note</button><h2></h2>';
								for(var i = 0; i < res2.rows.length; i++)
								{
									var daytim=res2.rows.item(i).cdate;
									var daytims=daytim.split(' ');
									//alert(daytims);
									var dts=daytims[0].split('-');
									var tms=daytims[1].split(':');
									var sd=dts[1]+'/'+dts[2]+'/'+dts[0];
									var st=tms[0]+':'+tms[1]+' AM';
									if(parseInt(tms[0])>11){
										st=tms[0]+':'+tms[1]+' PM';
									}
									html+='<div class="job-notes"><p>'+res2.rows.item(i).add_by+', '+sd+', '+st+': '+res2.rows.item(i).message+'</p></div>';
								}
								jQuery('.previous_notes').html(html);
							}
						});
						
						localStorage.setItem('startjob_status_text','Clocked In: '+res.rows.item(i).address);
						var startjob_status_text=localStorage.getItem('startjob_status_text');
						jQuery('.startjob_status_text').html(startjob_status_text);
						
						var newtimecount=localStorage.getItem('timecount2');
						if(typeof newtimecount!='undefined' && newtimecount!='' && newtimecount!=null){
							timecount2=newtimecount;
						}
						clearInterval(counter2);
						counter2=setInterval(jobtimer, 1000);
						jQuery('.job_clock_time').parents('li').addClass('clock_active');
						jQuery('.general_clock_time').parents('li').addClass('glck');
						
					}
					
					jQuery('.starttodayjob').addClass('step2');
				}
				jQuery('#job_id').val(job_id);
			});
			
		}
	}
	else if(job_id2!='undefined' && job_id2!=null && job_id2!='')
	{
		jQuery('.starttodayjob').addClass('step2');
	}
}
jQuery(document).ready(function(){
	
	jQuery( document ).on( "mobileinit", function() {
		jQuery.mobile.allowCrossDomainPages = true;
	});
	var contentType ="application/x-www-form-urlencoded; charset=utf-8";
    if(window.XDomainRequest){contentType = "text/plain";}
	var uid=localStorage.getItem('StaffMem_ID');
	if(typeof uid=='undefined' || uid=='' || uid==null){
		checkloggedin();
	}
	jQuery.support.cors = true;
	var job_id=gup('job_id');
	loadjob(job_id);
	
	var jobdone=gup('jobdone');
	if(jobdone=='1'){
		jQuery('.starttodayjob').addClass('step3');
		setTimeout(function(){jQuery('.starttodayjob').removeClass('step2');},1500);
	}
	
	var generaltime=localStorage.getItem('general_'+today);
	if(typeof generaltime!='undefined' && generaltime!='' && generaltime!=null){
		if(generaltime!='00:00:00'){
			jQuery('.general_clock_time').parents('li').addClass('glck');
			jQuery('.starttodayjob').text('Change Timer State');
			var startjob_status_text=localStorage.getItem('startjob_status_text');
			jQuery('.startjob_status_text').html(startjob_status_text);
			jQuery('.general_clock_time').html(generaltime);
			var job_timer=localStorage.getItem('job_'+today);
			jQuery('.job_clock_time').html(job_timer);
			if(startjob_status_text!='You are currently off the clock'){
				jQuery('.startjob_status_text').removeClass('offclock_st_color');
			}
			
			db.transaction(startdaytime2, function(){alert('test');}, successDB);
			function startdaytime2(tx){
				var q="SELECT * FROM job_daytimes WHERE start_date=?";
				var cond=[today];
				tx.executeSql(q, cond, function(tx, res){
					if(parseInt(res.rows.length)>0){
						var time1=res.rows.item(0).start_date+' '+res.rows.item(0).start_time;
						var time2=getdatetime();
						var wattime=gettimediff(time1,time2);
						wattime=wattime.split(':');
						
						timecount=(parseInt(wattime[0])*60*60*1000)+(parseInt(wattime[1])*60*1000)+(parseInt(wattime[2])*1000);
						//alert(wattime+'='+timecount);
						counter=setInterval(generaltimer, 1000);
						var jobid=res.rows.item(0).job_id;
						if(typeof jobid!='undefined' && jobid!='' && jobid!=null && (typeof job_id=='undefined' || jobid==null)){
							timecount2=localStorage.getItem('timecount2');
							timecount2=0;
							loadjob(jobid);
						}
					}
				});
			}
			
		}
		else{
			jQuery('.starttodayjob').text('Change Timer State');
			var startjob_status_text=localStorage.getItem('startjob_status_text');
			if(startjob_status_text=='You are currently off the clock'){
				jQuery('.startjob_status_text').addClass('offclock_st_color');
			}
			jQuery('.startjob_status_text').html(startjob_status_text);
			jQuery('.general_clock_time').html('00:00:00');
			jQuery('.job_clock_time').html('00:00:00');
		}
	}
	else{
		localStorage.setItem('general_'+today,'00:00:00');
		localStorage.setItem('job_'+today,'00:00:00');
		jQuery('.starttodayjob').text('Change Timer State');
		localStorage.setItem('startjob_status_text','You are currently off the clock');
		jQuery('.startjob_status_text').html('You are currently off the clock');
		jQuery('.general_clock_time').html('00:00:00');
		jQuery('.job_clock_time').html('00:00:00');
		
	}
	jQuery('.starttodayjob').click(function(){
		
		if(!jQuery('.starttodayjob').hasClass('step2') && !jQuery('.starttodayjob').hasClass('step3')){
			var generaltime=localStorage.getItem('general_'+today);
			jQuery('#myModal1').modal();
		}
		else if(jQuery('.starttodayjob').hasClass('step2') && !jQuery('.starttodayjob').hasClass('step3')){
			jQuery('#myModal2').modal();
		}
		else if(jQuery('.starttodayjob').hasClass('step3') && !jQuery('.starttodayjob').hasClass('step2')){
			jQuery('#myModal3').modal();
		}
	});
	jQuery('.step2_newxt_job').click(function(){
		localStorage.setItem('startjob_status_text','Clocked In: No Active Job');
		localStorage.setItem('stop_job_clock_'+today,'stop');
		jQuery('.startjob_status_text').html('Clocked In: No Active Job');
		clearInterval(counter2);
		var job_id=jQuery('#job_id').val();
		var job_id2=localStorage.getItem('finish_job');
		if(job_id!=job_id2 && job_id!='' && job_id!='0'){
			jQuery('#myModal2').modal('hide');
			jQuery('#addjobform').modal();
		}
		else{
			jQuery('#myModal2').modal('hide');
			window.location='today-jobs.html';
		}
	});
	jQuery('.step3_newxt_job').click(function(){
		localStorage.setItem('startjob_status_text','Clocked In: No Active Job');
		jQuery('.startjob_status_text').html('Clocked In: No Active Job');
		jQuery('.startjob_status_text').addClass('decline_job_status');
		window.location='today-jobs.html';
	});
	jQuery('.step2_stopclocks').click(function(){
		localStorage.setItem('startjob_status_text','You Are Currently Off the Clock');
		localStorage.setItem('stop_job_clock_'+today,'stop');
		localStorage.setItem('stop_general_clock_'+today,'stop');
		localStorage.setItem('stop_today_'+today,'stop');
		jQuery('.startjob_status_text').html('You Are Currently Off the Clock');
		jQuery('.job_clock_time').parents('li').removeClass('clock_active');
		clearInterval(counter);
		clearInterval(counter2);
		var job_id=jQuery('#job_id').val();
		var redirect=true;
		var job_id2=localStorage.getItem('finish_job');
		if(job_id!=job_id2 && job_id!='' && job_id!='undefined' && job_id!='0'){
			jQuery('#myModal2').modal('hide');
			jQuery('#addjobform').modal();
			redirect=false;
		}
		else{
			jQuery('#myModal2').modal('hide');
		}
		var currenttime=getcurrenttime();
		db.transaction(startlunch, errorDB, successDB);
		function startlunch(tx){
			tx.executeSql("UPDATE job_daytimes set end_time='"+currenttime+"' WHERE start_date='"+today+"' AND user_id='"+uid+"'");
			if(redirect){
				window.location='';
			}
		}
	});
	var clock_stop_for=localStorage.getItem('clock_stop_for_'+today);
	if(typeof clock_stop_for!='undefined' && clock_stop_for!='' && clock_stop_for!=null){
		if(clock_stop_for=='lunch'){
			jQuery('.starttodayjob').addClass('stopforlunch');
			jQuery('.startjob_status_text').html('Clocked Out To Lunch');
			setTimeout(function(){jQuery('.startjob_status_text').html('Clocked Out To Lunch');},1000);
		}
	}
	jQuery('.step2_stop_for_lunch').click(function(){
		var stop_today=localStorage.getItem('stop_today_'+today);
		if(stop_today!='stop'){
			localStorage.setItem('startjob_status_text','Clocked Out To Lunch');
			localStorage.setItem('stop_job_clock_'+today,'stop');
			localStorage.setItem('stop_general_clock_'+today,'stop');
			localStorage.setItem('clock_stop_for_'+today,'lunch');
			var currentdatetime=getdatetime();
			var currenttime=getcurrenttime();
			localStorage.setItem('stop_lunch_'+today,currentdatetime);
			jQuery('.startjob_status_text').html('Clocked Out To Lunch');
			db.transaction(startlunch, errorDB, successDB);
			function startlunch(tx){
				var job_id=jQuery('#job_id').val();
				var q2="SELECT * FROM job_times WHERE pu_date=? AND assigned_to=? AND job_id=? AND time_type=?";
					var cond2=[today,uid,job_id,'startjob'];
					tx.executeSql(q2, cond2, function(tx, res2){
						if(parseInt(res2.rows.length)>0){
							var uq="UPDATE job_times set end_time='"+currenttime+"' WHERE pu_date='"+today+"' AND assigned_to='"+uid+"' AND job_id='"+job_id+"' AND time_type='startjob' AND end_time='00:00:00'";
							alert(uq);
							tx.executeSql(uq);
						}
						
					});
				tx.executeSql('INSERT INTO job_times (job_id, assigned_to, pu_date, start_time, time_type, cdate) VALUES ("'+job_id+'", "'+uid+'","'+today+'", "'+currenttime+'","lunch", "'+currentdatetime+'")');
			}
			jQuery('.starttodayjob').addClass('stopforlunch');
			clearInterval(counter);
			clearInterval(counter2);
			jQuery('#myModal2').modal('hide');
			jQuery('.stopforlunch').click(function(){
				localStorage.removeItem('stop_job_clock_'+today);
				localStorage.removeItem('stop_general_clock_'+today);
				localStorage.removeItem('clock_stop_for_'+today);
				localStorage.setItem('startjob_status_text','Clocked In: No Active Job');
				db.transaction(startlunch, errorDB, successDB);
				function startlunch(tx){
					var job_id=jQuery('#job_id').val();
					tx.executeSql("UPDATE job_times set end_time='"+currenttime+"' WHERE pu_date='"+today+"' AND assigned_to='"+uid+"' AND job_id='"+job_id+"' AND time_type='lunch' AND end_time='00:00:00'");
					tx.executeSql('INSERT INTO job_times (job_id, assigned_to, pu_date, start_time, time_type, cdate) VALUES ("'+job_id+'", "'+uid+'","'+today+'", "'+currenttime+'","startjob", "'+currentdatetime+'")');
					window.location='';
				}
				
			});
		}
		jQuery('.job_clock_time').parents('li').removeClass('clock_active');
		//else{
			jQuery('#myModal2').modal('hide');
			jQuery('#myModal3').modal('hide');
		//}
	});
	jQuery('.stopforlunch').click(function(){
		jQuery('.job_clock_time').parents('li').removeClass('clock_active');
		localStorage.removeItem('stop_job_clock_'+today);
		localStorage.removeItem('stop_general_clock_'+today);
		localStorage.removeItem('clock_stop_for_'+today);
		db.transaction(startlunch, errorDB, successDB);
		function startlunch(tx){
			var job_id=jQuery('#job_id').val();
			tx.executeSql("UPDATE job_times set end_time='"+currenttime+"' WHERE pu_date='"+today+"' AND assigned_to='"+uid+"' AND job_id='"+job_id+"' AND time_type='lunch' AND end_time='00:00:00'");
			tx.executeSql('INSERT INTO job_times (job_id, assigned_to, pu_date, start_time, time_type, cdate) VALUES ("'+job_id+'", "'+uid+'","'+today+'", "'+currenttime+'","startjob", "'+currentdatetime+'")');
			window.location='';
		}
		
	});
	
	jQuery('.decline_job').click(function(){
		jQuery('.startjob_status_text').removeClass('offclock_st_color');
		jQuery('.general_clock_time').parents('li').addClass('glck');
		localStorage.setItem('startjob_status_text','Clocked In: No Active Job');
		jQuery('.startjob_status_text').html('Clocked In: No Active Job');
		jQuery('.startjob_status_text').addClass('decline_job_status');
		jQuery('#myModal1').modal('hide');
		clearInterval(counter);
		counter=setInterval(generaltimer, 1000);
		db.transaction(startdaytime, errorDB, successDB);
		function startdaytime(tx){
			var q="SELECT * FROM job_daytimes WHERE start_date=? AND user_id=?";
			var cond=[today,uid];
			tx.executeSql(q, cond, function(tx, res){
				if(parseInt(res.rows.length)>0){
					
				}
				else{
					
					tx.executeSql('INSERT INTO job_daytimes (start_date, start_time, user_id) VALUES ("'+today+'", "'+currenttime+'", "'+uid+'")');
				}
			});
		}
	});
	jQuery('.accept_job').click(function(){
		jQuery('.startjob_status_text').removeClass('offclock_st_color');
		jQuery('.general_clock_time').parents('li').addClass('glck');
		localStorage.setItem('startjob_status_text','Clocked In: No Active Job');
		jQuery('.startjob_status_text').html('Clocked In: No Active Job');
		jQuery('.startjob_status_text').addClass('decline_job_status');
		jQuery('#myModal1').modal('hide');
		clearInterval(counter);
		var currenttime=getcurrenttime();
		counter=setInterval(generaltimer, 1000);
		db.transaction(startdaytime, errorDB, successDB);
		function startdaytime(tx){
			var q="SELECT * FROM job_daytimes WHERE start_date=? AND user_id=?";
			var cond=[today, uid];
			tx.executeSql(q, cond, function(tx, res){
				if(parseInt(res.rows.length)>0){
					
				}
				else{
					
					tx.executeSql('INSERT INTO job_daytimes (start_date, start_time, user_id) VALUES ("'+today+'", "'+currenttime+'", "'+uid+'")');
				}
			});
		}
		setTimeout(function(){
			window.location='today-jobs.html';
		},1200);
	});
	
	jQuery('.savenewnote').click(function(){
		var noerror=true;
		jQuery('#noteform textarea.required').each(function(){
			var v=jQuery(this).val();
			if(jQuery.trim(v)==''){
				jQuery(this).addClass('error');
				noerror=false;
			}
		});
		var job_id=jQuery('#job_id').val();
		var msg=jQuery('#notemsg').val();
		var currentdatetime=getdatetime();
		if(noerror){
			db.transaction(addnewnotes, errorDB, successDB);
			function addnewnotes(tx){
				var q="SELECT * FROM userlogin WHERE user_id=?";
				var cond=[uid];
				tx.executeSql(q, cond, function(tx, res){
					if(parseInt(res.rows.length)>0){
						
						var fname=res.rows.item(0).fname;
						var lname=res.rows.item(0).lname;
						var add_by=fname+' '+lname;
						tx.executeSql('INSERT INTO job_notifications (job_id, job_notification_id, title, message, add_by, cdate, nfrom, user_id) VALUES ("'+job_id+'", "0", "Note", "'+msg+'", "'+add_by+'", "'+currentdatetime+'", "app", "'+uid+'")');
						window.location='';
					}
				});
			}
		}
	});
	jQuery('.savenejobform').click(function(){
		var noerror=true;
		jQuery('#jobform textarea.required').each(function(){
			var v=jQuery(this).val();
			if(jQuery.trim(v)==''){
				jQuery(this).addClass('error');
				noerror=false;
			}
		});
		jQuery('#jobform input.required').each(function(){
			var v=jQuery(this).val();
			if(jQuery.trim(v)==''){
				jQuery(this).addClass('error');
				noerror=false;
			}
		});
		var keys=[];
		var types=[];
		var vs=[];
		jQuery('#jobform textarea').each(function(){
			var value=jQuery(this).val();
			var key=jQuery(this).attr('name');
			keys.push(key); 
			vs.push(value);
			types.push('textarea');
		});
		jQuery('#jobform input[type="text"]').each(function(){
			var value=jQuery(this).val();
			var key=jQuery(this).attr('name');
			keys.push(key); 
			vs.push(value);
			types.push('text');
		});
		jQuery('#jobform input[type="number"]').each(function(){
			var value=jQuery(this).val();
			var key=jQuery(this).attr('name');
			keys.push(key); 
			vs.push(value);
			types.push('number');
		});
		var arr=[];
		jQuery.each( $('#jobform input:radio'), function(){
		  var myname= this.name;
		  if( jQuery.inArray( myname, arr ) < 0 ){
			arr.push(myname);
		  }
		});
		for(k=0;k<arr.length;k++){
			var key=arr[k];
			var v=jQuery('input[name="'+key+'"]:checked').val();
			types.push('radio');
			keys.push(key); 
			if(typeof v=='undefined'){v='';}
			vs.push(v);
		}
		var arr=[];
		jQuery.each( $('#jobform input:checkbox'), function(){
		  var myname= this.name;
		  if( jQuery.inArray( myname, arr ) < 0 ){
		  	arr.push(myname);
		  }
		});
		for(k=0;k<arr.length;k++){
			var key=arr[k];
			var v=jQuery('input[name="'+key+'"]:checked').val();
			types.push('radio');
			keys.push(key); 
			if(typeof v=='undefined'){v='';}
			vs.push(v);
		}
		var job_id=jQuery('#job_id').val();
		var currentdatetime=getdatetime();
		var endtime=getcurrenttime();
		if(noerror){
			db.transaction(addnewnotes, errorDB, successDB);
			function addnewnotes(tx){
				var query="INSERT INTO job_forms('job_id','add_by','form_title','cdate') values(?,?,?,?)";
				var values=[job_id,uid,'jobform',currentdatetime];
				tx.executeSql(query,values,function(tx, results){
					var form_id = results.insertId; 
					for(i=0;i<keys.length;i++){
						var qry="INSERT INTO job_form_values('job_id','form_id','field_key', field_type,'field_value') values('"+job_id+"', '"+form_id+"', '"+keys[i]+"', '"+types[i]+"', '"+vs[i]+"')";
						tx.executeSql(qry);
					}
					
				});
				var qry="UPDATE jobs set status='Completed', real_end_time='"+endtime+"' WHERE job_id='"+job_id+"' AND  user_id='"+uid+"'";
				tx.executeSql(qry);
				var uq="UPDATE job_times set end_time='"+endtime+"' WHERE pu_date='"+today+"' AND assigned_to='"+uid+"' AND job_id='"+job_id+"' AND time_type='startjob' AND end_time='00:00:00'";
				alert(uq);
				tx.executeSql(uq);
				tx.executeSql('INSERT INTO job_notifications (job_id, job_notification_id, title, message, add_by, cdate, nfrom, user_id) VALUES ("'+job_id+'", "0", "Form", "", "'+uid+'", "'+currentdatetime+'", "app", "'+uid+'")');
				var q="SELECT * FROM userlogin WHERE user_id=?";
				var cond=[uid];
				tx.executeSql(q, cond, function(tx, res){
					if(parseInt(res.rows.length)>0){
						
						var fname=res.rows.item(0).fname;
						var lname=res.rows.item(0).lname;
						var add_by=fname+' '+lname;
						tx.executeSql('INSERT INTO job_notifications (job_id, job_notification_id, title, message, add_by, cdate, nfrom, user_id) VALUES ("'+job_id+'", "0", "Form", "", "'+add_by+'", "'+currentdatetime+'", "app", "'+uid+'")');
						localStorage.setItem('finish_job',job_id);
						window.location='startday.html?jobdone=1';	
					}
				});
				
			}
			
		}
	});
	db.transaction(checkjobexusts, errorDB, successDB);
	function checkjobexusts(tx){
		var q="SELECT * FROM jobs WHERE job_date=? AND user_id=? AND status=?";
		var cond=[today,uid,'Assigned'];
		tx.executeSql(q, cond, function(tx, res){
			if(parseInt(res.rows.length)<=0){
				jQuery('.nojobexist').hide();
				jQuery('#myModal1 .pop-btm-cnt:first ul').append('<li><a href="">Syn</a></li>');
			}
		});
	}
});

</script>
</body>
</html>