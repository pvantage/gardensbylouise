<!doctype html>
<html lang="en">
<head>
<title>Gardens By Louise LLC</title>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<link rel="stylesheet" href="css/fonts-styles.css">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/jquery-ui.css">
<link rel="stylesheet" href="css/mycss.css">
</head>
<body class="light-grey-bg after-login schlbody">
<!----- Header Top ----->
<div class="container mysch-fix-hdr">
  <div class="header-top">
    <div class="row  align-items-center">
	<img src="images/hdr-logo.png" alt="header-logo" />
      <!--<div class="col-2 header-left-col"><a href="#" data-toggle="modal" data-target="#myModal15"><i class="icon-glass"></i></a></div>
      <div class="col header-center-col">
        <div class="top-header-links">
          <ul class="nav nav-tabs">
            <li><a data-toggle="tab" href="#home" class="active">List</a></li>
            <li><a data-toggle="tab" href="#menu1">Calendar</a></li>
            <li><a data-toggle="tab" href="#menu2">Map</a></li>
          </ul>
		  <ul class="calsubmenus nav nav-tabs cal-submenu">
			<li><a data-toggle="tab" href="#menu1">Day</a></li>
			<li><a data-toggle="tab" href="#menu3">Week</a></li>
			<li><a data-toggle="tab" href="#menu4">Month</a></li>
		</ul>
        </div>
      </div>
      <div class="col-2 header-right-col"><a href="#" data-toggle="modal" data-target="#myModal5"><i class="icon-plus"></i></a></div>-->
    </div>
  </div>
</div>
<!----- /Header Top ----->
<input type="hidden" id="week_show" value="1">
<input type="hidden" id="month_show" value="1">
<input type="hidden" id="month_srchstart" value="1">
<input type="hidden" id="week_srchstart" value="1">
<div class="container cntbox tab-content">
  <div id="home" class="tab-pane fade in active show">
    <h1 class="myschle">My Jobs</h1>
    <div class="srchmainss"><img src="images/srch.png"/>
      <input class="sch-srch" type="search" placeholder="search">
    </div>
	<div class="job_list"></div>
  </div>
  <div id="menu1" class="tab-pane fade cal-allcnt">
	<div class="cl-wrap cal_joblist"></div>
  </div>
  <div id="menu3" class="tab-pane fade cal-allcnt">
	<div class="cl-wrap cal_joblist3"></div>
  </div>
  <div id="menu4" class="tab-pane fade cal-allcnt">
	<div class="cl-wrap cal_joblist4"></div>
  </div>
  <div id="menu2" class="tab-pane fade map-maincnt">
    <div class="map-cnt"> <div id="ourgmap" style="width:100%; height:300px;"></div></div>
	<div class="map_joblist"></div>
    
  </div>
</div>
<!----- Bottom Nav Bar ----->
<div class="bottom-nav-bar"></div>
<!----- /Bottom Nav Bar -----> 

<!-- Optional JavaScript --> 
<!-- jQuery first, then Popper.js, then Bootstrap JS --> 

<div id="myModal1" class="modal fade bottom-popup" role="dialog">
  <div class="modal-dialog"> 
    
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body">
        <div class="pop-cnt">
          <div class="pop-btm-cnt">
            <ul>
              <li class="caljob_title">Job #101</li>
              <li><a href="#" class="caljob_link">View Job</a></li>
              <li><a href="javascript:;" class="caljob_reschedule">Reschedule Job</a></li>
            </ul>
          </div>
          <div class="pop-btm-cnt pop-cancel">
            <ul>
              <li> <a data-dismiss="modal">Cancel</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



<div id="myModal5" class="modal fade bottom-popup" role="dialog">
  <div class="modal-dialog"> 
    
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body">
        <div class="pop-cnt">
          <div class="pop-btm-cnt">
            <ul>
              <li><a href="javascript:;" class="addnewjob">New Job</a></li>
            </ul>
          </div>
          <div class="pop-btm-cnt pop-cancel">
            <ul>
              <li> <a data-dismiss="modal">Cancel</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="myModal6" class="modal fade popupformats" role="dialog">
  <div class="modal-dialog"> 
    
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body">
        <div class="pop-head">
          <div class="row">
            <button type="button" class="close col-2 donbtn" data-dismiss="modal">Cancel</button>
            <div class="col-7 pop-title job-title"></div>
            <div class="col-3 pop-hd-right bkbtn"><a href="javascript:;" class="savejob">Save</a></div>
          </div>
        </div>
        <div class="pop-cnt">
          <div class="new-job">
		  	<div class="errormsg"></div>
		  	<form id="editform" name="editform" action="" method="post">
			<input type="hidden" id="recid" name="recid" value="" />
			<input type="hidden" id="customer_id" name="customer_id" value="" />
			<input type="hidden" id="old_status" name="old_status" value="Unassigned" />
			<input type="hidden" name="add_by" value="" />
            <div class="form-box">
              <label>CLIENT NAME</label>
			  <div style="position:relative;">
			  	<input type="text" name="customer_full_name" id="customer_full_name" placeholder="Enter Client Name" /><div class="suggestion_box"></div>
			  </div>
            </div>
            <div class="form-box">
              <label>ADDRESS</label>
              <input type="text" name="address" id="address" placeholder="Enter Address">
            </div>
            <div class="form-box">
              <label>CONTACT DETAILS</label>
              <div class="multiinput">
                <input type="text" placeholder="Contact First Name" id="contact_fname" name="contact_fname">
				<input type="text" placeholder="Contact Last Name" id="contact_lname" name="contact_lname">
                <input type="email" placeholder="Email" id="contact_email" name="contact_email">
                <input type="number" placeholder="Phone" id="contact_phone" name="contact_phone">
                <input type="number" placeholder="Mobile" id="contact_mobile" name="contact_mobile">
              </div>
            </div>
            <div class="form-box">
              <label>ITEMS FOR PICKUP</label>
              <textarea placeholder="Enter Detail" rows="3" cols="40" name="description" id="description"></textarea>
            </div>
			</form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>





<div id="myModal15" class="modal fade popupformats filterjobs" role="dialog">
  <div class="modal-dialog"> 
    
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body">
        <div class="pop-head">
          <div class="row">
            <button type="button" class="close col-2 donbtn" data-dismiss="modal">Cancel</button>
            <div class="col-7 pop-title">Filters Jobs</div>
          </div>
        </div>
        <div class="pop-cnt">
          <div class="pop-edit-item p-pic-req jdtl">
            <div class="form-box">
              <label>
              <div class="checkbox">
                <label>My Schedule
                  <input type="checkbox" id="myschedule" checked="checked" value="yes" />
                </label>
              </div>
              </label>
              <select class="onclick" id="fileter-status">
			  	<option value="">All Jobs</option> 
				<optgroup label="Jobs">
                <option value="job-unassigned">Unassigned Jobs</option>
				<option value="job-assigned">Assigned Jobs</option>
				<option value="job-beingprocessed">Being Processed Jobs</option>
                <option value="job-completed">Completed Jobs</option>
                </optgroup>
                <optgroup label="Staff"></optgroup>
               
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<script src="js/jquery-3.2.1.min.js" ></script> 

<script src="js/jquery-ui.min.js" ></script>
<script src="js/popper.min.js" ></script> 
<script src="js/bootstrap.min.js" ></script>
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script type="text/javascript" src="js/config.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?sensor=true&libraries=geometry&key=AIzaSyAdRw4y6QbeCa2AVoQcI_j7NMQZPYDrabU" type="text/javascript"></script>
<script type="text/javascript" src="js/jquery.touchSwipe.js"></script>
<script type="text/javascript">
var reqtime=1;
(function($) {
    $.fn.hasScrollBar = function() {
        return this.get(0).scrollHeight > this.height();
    }
})(jQuery);
function showonmap($this,latit,longit,jobstatus,job_id)
{}
function deletepu(pu_id,job_id)
{
	var url2=siteurl+'/api/jobs/deletepurequest';
	jQuery.ajax({  
		type: 'POST',  
		url: url2,           
		crossDomain: true,
		data: {job_pu_id:pu_id}, 
		beforeSend: function() {
		},		
		complete: function() {
		}, 
		crossDomain: true,  
		success: function(res) {
			listschedules();
			jQuery('body .showmessage').remove();
			var html='<div class="showmessage">PU Requested cancelled.</div>';
			jQuery('body').append(html);
			setTimeout(function(){jQuery('.showmessage').slideUp();},3000);
			jQuery('#myModal221').modal('hide');
			jQuery('#myModal1').modal('hide');
			
			
		},  
		error: function(response, d, a){
		
			jQuery('body .showmessage').remove();
			var html='<div class="showmessage">Server Error.</div>';
			jQuery('body').append(html);
			setTimeout(function(){jQuery('.showmessage').slideUp();},1000);
			return false; 
		}
	});
}
function listschedules(){
	var uid=localStorage.getItem('Staff_ID');
	var url=siteurl+'/api/jobs/myschedulejobs';
	if(!jQuery('#myschedule').is(':checked'))
	{
		uid='';	
	}
	var fileterstatus=jQuery('#fileter-status').val();
	var searchtext=jQuery('input.sch-srch').val();
	jQuery.ajax({  
		type: 'POST',  
		url: url,           
		dataType: 'json',  
		crossDomain: true,
		data: {assigned_to:uid, status:fileterstatus, searchtext:searchtext}, 
		beforeSend: function() {
		
		},		
		complete: function() {
		}, 
		crossDomain: true,  
		success: function(res) { 
			var html='';
			jQuery('.map_joblist, .job_list, .cal_joblist, .cal_joblist3, .cal_joblist4').html('');
			if(res['list'])
			{
				
				jQuery(res['list']).each(function(index){
					if(typeof res['list'][index]!='undefined'){
						html='<div class="schedule-wrap">';
						if(res['list'][index]['pu_day']=='Today'){html+='<div class="schedule-day">Today</div>';}
						else{html+='<div class="schedule-day"><div class="row"><div class="col-5"> '+res['list'][index]['pu_day']+'</div><div class="col text-right"> '+res['list'][index]['job_date']+'</div></div></div>';}
						if(res['list'][index]['records'])
						{
							jQuery(res['list'][index]['records']).each(function(index2){
								if(res['list'][index]['records'][index2]['status']=='Assigned'){
									html+='<div class="schedule-detail assigned-status"> <a href="job.html?job_id='+res['list'][index]['records'][index2]['ID']+'"><span class="schedule-circle"></span>';
								}
								else if(res['list'][index]['records'][index2]['status']=='Unassigned'){
									html+='<div class="schedule-detail assigned-status"> <a href="job.html?job_id='+res['list'][index]['records'][index2]['ID']+'"><span class="schedule-circle"></span>';
								}
								else if(res['list'][index]['records'][index2]['status']=='Being Processed'){
									html+='<div class="schedule-detail processing-status"> <a href="job.html?job_id='+res['list'][index]['records'][index2]['ID']+'"><span class="schedule-circle"></span>';
								}
								else if(res['list'][index]['records'][index2]['status']=='Completed'){
									html+='<div class="schedule-detail completed-status"> <a href="job.html?job_id='+res['list'][index]['records'][index2]['ID']+'"><span class="schedule-circle"></span>';
								}
								html+='<div class="row align-items-center"><div class="col-9 schedule-time">'+res['list'][index]['records'][index2]['start_time']+'</div><div class="col-3 schedule-hashtag">#'+res['list'][index]['records'][index2]['ID']+'</div></div><div class="schedule-address"><h3>'+res['list'][index]['records'][index2]['contact_fname']+' '+res['list'][index]['records'][index2]['contact_lname']+'</h3><div class="sch-adr">'+res['list'][index]['records'][index2]['address']+'</div><span class="grey-color">'+res['list'][index]['records'][index2]['description']+'</span></div></a> </div>';
							});
							
							jQuery(res['list'][index]['records']).each(function(index2){
								var maplist='';
								var linkj='job.html?job_id='+res['list'][index]['records'][index2]['ID'];
								var onclickfn='';
								if(jQuery.trim(res['list'][index]['records'][index2]['lati'])!='' || jQuery.trim(res['list'][index]['records'][index2]['longi'])!='')
								{
									linkj='javascript:;';
									var jstatus=res['list'][index]['records'][index2]['status'];
									//onclickfn=' onclick="return showonmap(this,'+parseFloat(res['list'][index]['records'][index2]['lati'])+','+parseFloat(res['list'][index]['records'][index2]['longi'])+',\''+jstatus+'\','+res['list'][index]['records'][index2]['ID']+')"';
								}
								if(res['list'][index]['records'][index2]['status']=='Assigned'){
									maplist+='<div class="schedule-detail assigned-status"> <a href="'+linkj+'"'+onclickfn+'><span class="schedule-circle"></span>';
								}
								else if(res['list'][index]['records'][index2]['status']=='Unassigned'){
									maplist+='<div class="schedule-detail assigned-status"> <a href="'+linkj+'"'+onclickfn+'><span class="schedule-circle"></span>';
								}
								else if(res['list'][index]['records'][index2]['status']=='Being Processed'){
									maplist+='<div class="schedule-detail processing-status"> <a href="'+linkj+'"'+onclickfn+'><span class="schedule-circle"></span>';
								}
								else if(res['list'][index]['records'][index2]['status']=='Completed'){
									maplist+='<div class="schedule-detail completed-status"> <a href="'+linkj+'"'+onclickfn+'><span class="schedule-circle"></span>';
								}
								maplist+='<div class="row align-items-center"><div class="col-9 schedule-time">'+res['list'][index]['records'][index2]['start_time']+'</div><div class="col-3 schedule-hashtag">#'+res['list'][index]['records'][index2]['ID']+'</div></div><div class="schedule-address"><h3>'+res['list'][index]['records'][index2]['contact_fname']+' '+res['list'][index]['records'][index2]['contact_lname']+'</h3><div class="sch-adr">'+res['list'][index]['records'][index2]['address']+'</div><span class="grey-color">'+res['list'][index]['records'][index2]['description']+'</span></div></a> </div>';
								
								jQuery('.map_joblist').append(maplist);
							});
						}
						html+='</div>';
		
						jQuery('.job_list').append(html);
					}
				});
				
				
			}
			
			jQuery('.top-header-links li a').click(function(){});
				jQuery('a.openmyModal1').click(function(){
					var jid=jQuery(this).attr('data-jobid');
					var resid=jQuery(this).attr('data-id');
					jQuery('#myModal1 .caljob_title').html('Job #'+jid);
					jQuery('#myModal1 .caljob_link').attr('href','job.html?job_id='+jid);
					jQuery('#myModal1 .caljob_reschedule').attr('data-id',resid);
					jQuery('#myModal1').modal();
				});
			var openedtab=localStorage.getItem('openedtab');
			if(typeof openedtab!='undefine' && openedtab!='' && openedtab!=null){
				jQuery('.top-header-links li a').each(function(){
					var target=jQuery(this).attr('href');
					if(openedtab=='#menu1' && target==openedtab){
						jQuery('.nav-tabs li a[href="#menu1"]:first').trigger('click');
						jQuery('.calsubmenus li a[href="#menu1"]').addClass('active');
						jQuery('ul.calsubmenus').addClass('current');
					}
					else if((openedtab=='#menu3' || openedtab=='#menu4') && target==openedtab){
						jQuery(this).trigger('click');
						jQuery('.nav-tabs li a[href="#menu1"]:first').addClass('active');
						jQuery('ul.calsubmenus').addClass('current');
						jQuery('.calsubmenus li a[href="#menu1"]').removeClass('active');
					}
					else{
						if(target==openedtab){
							jQuery(this).trigger('click');
						}
					}
				});
			}
			
			var totalcal=jQuery('.cal_joblist3 .cal-details .cal-rightbx').length;
			var totalweekmonth=0;
			var totalweekmonth2=0;
			var totalcal2=jQuery('.cal_joblist4 .cal-details .cal-rightbx').length;
			if(res['week']['total']){
				totalweekmonth=res['week']['total'];
			}
			if(res['month']['total']){
				totalweekmonth2=res['month']['total'];
			}
			//alert(uid);
			/*setTimeout(function(){
				
				if(!$(window).hasScrollBar() && parseInt($(window).scrollTop())<=5){
					if(parseInt(totalweekmonth)>parseInt(totalcal)){
						$(".cal_joblist3").append('<a href="javascript:;" onclick="showweekmonthsch();" class="btn loadmore3">Load More</a>');
					}
					if(parseInt(totalweekmonth2)>parseInt(totalcal2)){
						$(".cal_joblist4").append('<a href="javascript:;" onclick="showweekmonthsch();" class="btn loadmore4">Load More</a>');
					}
				}
			},1000);*/
			
			
		},  
		error: function(response, d, a){
		
		jQuery('body .showmessage').remove();
		var html='<div class="showmessage">Server Error.</div>';
		jQuery('body').append(html);
		setTimeout(function(){jQuery('.showmessage').slideUp();},1000);
		return false; 
		}
	});
}

jQuery(document).ready(function(){
	
	jQuery( document ).on( "mobileinit", function() {
		jQuery.mobile.allowCrossDomainPages = true;
	});
	var contentType ="application/x-www-form-urlencoded; charset=utf-8";
    if(window.XDomainRequest){contentType = "text/plain";}
	var uid=localStorage.getItem('Staff_ID');
	jQuery('input[name="add_by"]').val(uid);
	jQuery.support.cors = true;
	url=siteurl+'/api/jobs/jobrelatedthings';
	jQuery.ajax({  
		type: 'POST',  
		url: url,           
		dataType: 'json',  
		crossDomain: true,
		data: {}, 
		beforeSend: function() {
		},		
		complete: function() {
		}, 
		crossDomain: true,  
		success: function(res) { 
			/*if(res['job_status']){
				jQuery(res['job_status']).each(function(key){
					jQuery('select[name="status"]').append('<option value="'+res['job_status'][key]+'">'+res['job_status'][key]+'</option>');
				});
			}
			if(res['categories']){
				jQuery(res['categories']).each(function(key){
					jQuery('select[name="category_id"]').append('<option value="'+res['categories'][key]['ID']+'">'+res['categories'][key]['name']+'</option>');
				});
			}*/
			if(res['job_times']){
				for (var i in res['job_times']) {
					jQuery('select[name="start_time"]').append('<option value="'+i+'">'+res['job_times'][i]+'</option>');
				}
			}
			if(res['job_durations']){
				for (var i in res['job_durations']) {
					jQuery('select[name="duration"]').append('<option value="'+res['job_durations'][i]+'">'+i+'</option>');
				}
			}
			if(res['staffmembers']){
				jQuery(res['staffmembers']).each(function(key){
					jQuery('select#fileter-status optgroup[label="Staff"]').append('<option value="job-assigned-to-'+res['staffmembers'][key]['id']+'">'+res['staffmembers'][key]['fname']+' '+res['staffmembers'][key]['lname']+'</option>');
					jQuery('select[name="assigned_to"]').append('<option value="'+res['staffmembers'][key]['id']+'">'+res['staffmembers'][key]['fname']+' '+res['staffmembers'][key]['lname']+'</option>');
					
				});
			}
		},  
		error: function(response, d, a){
		
		jQuery('body .showmessage').remove();
		var html='<div class="showmessage">Server Error.</div>';
		jQuery('body').append(html);
		setTimeout(function(){jQuery('.showmessage').slideUp();},1000);
		return false; 
		}
	});
	
	listschedules();
	jQuery('#fileter-status').change(function(){
		listschedules();
		jQuery('#myModal15').modal('hide');
	});
	jQuery('input.sch-srch').keyup(function(){
		listschedules();
	});
	jQuery('#myschedule').change(function(){
		listschedules();
		jQuery('#myModal15').modal('hide');
	});
	jQuery('#task_due_date, #job_date, #job_date2, #job_date3, #job_date4').datepicker({
		showButtonPanel: true,
		changeMonth: true,
		changeYear: true,
		dateFormat: 'yy-mm-dd'
	});
	jQuery('a.caljob_reschedule').click(function(){
		var url2=siteurl+'/api/jobs/pudetail';
		var pu_id=jQuery(this).attr('data-id');
		jQuery('#pu_id').val(pu_id);
		jQuery.ajax({  
			type: 'POST',  
			url: url2,           
			dataType: 'json',  
			crossDomain: true,
			data: {pu_id:pu_id}, 
			beforeSend: function() {
			},		
			complete: function() {
			}, 
			crossDomain: true,  
			success: function(res) { 
				if(res['data'])
				{
					jQuery('#myModal221 input[name="job_date2"]').val(res['data']['job_date']);
					jQuery('#myModal221 select[name="assigned_to"]').val(res['data']['assigned_to']);
					jQuery('#myModal221 select[name="start_time"]').val(res['data']['start_time']);
					jQuery('#myModal221 .assign-name').html(res['data']['by']);
					jQuery('.deletepulink').html('<a href="javascript:;" class="whitebase" onclick="return deletepu('+pu_id+','+res['data']['job_id']+')">Cancel PU Request</a>');
					jQuery('#myModal221').modal();
				}
				
				
			},  
			error: function(response, d, a){
			
			jQuery('body .showmessage').remove();
			var html='<div class="showmessage">Server Error.</div>';
			jQuery('body').append(html);
			setTimeout(function(){jQuery('.showmessage').slideUp();},1000);
			return false; 
			}
		});
	});
	jQuery('#myModal221 a.updatepurequest').click(function(){
		var noerror=true;
		jQuery('#myModal221 input.required, #myModal221 select.required').each(function(){
			var v=jQuery(this).val();
			if(jQuery.trim(v)==''){
				noerror=false;
				jQuery(this).addClass('error');
			}
			else{
				jQuery(this).removeClass('error');
			}
		});
		if(noerror){
		
			var duration2=jQuery('#myModal221 select[name="duration"]').val();
			var job_date2=jQuery('#myModal221 input[name="job_date2"]').val();
			var assigned_to=jQuery('#myModal221 select[name="assigned_to"]').val();
			var start_time2=jQuery('#myModal221 select[name="start_time"]').val();
			var pu_id=jQuery('#myModal221 input[name="pu_id"]').val();
			var url=siteurl+'/api/jobs/saveeditpurequest';
			jQuery.ajax({  
				type: 'POST',  
				url: url,           
				crossDomain: true,
				data: {duration2:duration2,job_date2:job_date2,assigned_to2:assigned_to,start_time2:start_time2,pu_id:pu_id}, 
				beforeSend: function() {
					
				},		
				complete: function() {
				}, 
				crossDomain: true,  
				success: function(res) { 
					listschedules();
					jQuery('#myModal221').modal('hide');
					jQuery('body .showmessage').remove();
					var html='<div class="showmessage">PU Request updated successfully.</div>';
					jQuery('body').append(html);
					setTimeout(function(){jQuery('.showmessage').slideUp();},3000);
				},  
				error: function(response, d, a){
				
				jQuery('body .showmessage').remove();
				var html='<div class="showmessage">Server Error.</div>';
				jQuery('body').append(html);
				setTimeout(function(){jQuery('.showmessage').slideUp();},1000);
				return false; 
				}
			});
		}
	});
	jQuery('a.addnewjob').click(function(){
		
		var url=siteurl+'/api/jobs/startnewjob';
		jQuery.ajax({  
			type: 'POST',  
			url: url,           
			crossDomain: true,
			data: {add_by:uid}, 
			beforeSend: function() {
				
			},		
			complete: function() {
			}, 
			crossDomain: true,  
			success: function(res) {
				if(parseInt(res)>0){ 
					jQuery('#myModal6 .job-title').html('New JOB #'+res);
					jQuery('#myModal6 #recid').val(res);
					jQuery('#myModal6').modal();
				}
			},  
			error: function(response, d, a){
			
			jQuery('body .showmessage').remove();
			var html='<div class="showmessage">Server Error.</div>';
			jQuery('body').append(html);
			setTimeout(function(){jQuery('.showmessage').slideUp();},1000);
			return false; 
			}
		});
		
	});
	jQuery('#customer_full_name').keyup(function(){
		var full_name=jQuery(this).val();
		if(jQuery.trim(full_name)==''){
			jQuery('.suggestion_box').html('');
			jQuery('.suggestion_box').hide();
		}
		else
		{
			jQuery('.suggestion_box').show();
			var url=siteurl+'/api/jobs/searchcustomers';
				jQuery.ajax({ 
				 type: 'POST',  
				 url: url,  
				 //contentType: contentType,  
				 dataType: 'json',  
				 data: {full_name:full_name},  
				 beforeSend: function() {
				 },		
				 complete: function() {
				 },
				 success: function(res) { 
				   if(res['record']){
						var html='<ul>';
						jQuery(res['record']).each(function(index){
							html+='<li><a href="javascript:;" class="select_customer" data-id="'+res['record'][index]['id']+'" data-name="'+res['record'][index]['full_name']+'" data-address="'+res['record'][index]['address']+'" data-fname="'+res['record'][index]['fname']+'" data-lname="'+res['record'][index]['lname']+'" data-email="'+res['record'][index]['email']+'" data-phone="'+res['record'][index]['mobile']+'"><span class="cust_f_name">'+res['record'][index]['full_name']+'</span><span class="cust_addres">'+res['record'][index]['address']+'</span></a></li>';
						});
						html+='</ul>';
						jQuery('.suggestion_box').css({'height':'200px'});
						
						jQuery('.suggestion_box').html(html);
						if(res['record'].length==0){
							jQuery('.suggestion_box').html('');
							jQuery('.suggestion_box').css({'height':'0px'});
						}
						jQuery('.select_customer').click(function(){
							var dataid=jQuery(this).attr('data-id');
							jQuery('#customer_id').val(dataid);
							var dataname=jQuery(this).attr('data-name');
							jQuery('#customer_full_name').val(dataname);
							var dataaddress=jQuery(this).attr('data-address');
							jQuery('#address').val(dataaddress);
							var dataemail=jQuery(this).attr('data-email');
							jQuery('#contact_email').val(dataemail);
							var datafname=jQuery(this).attr('data-fname');
							jQuery('#contact_fname').val(datafname);
							var datalname=jQuery(this).attr('data-lname');
							jQuery('#contact_lname').val(datalname);
							var dataphone=jQuery(this).attr('data-phone');
							jQuery('#contact_phone').val(dataphone);
							jQuery('.suggestion_box').html('');
							jQuery('.suggestion_box').css({'height':'0px'});
						});
				   }
				 },  
				 error: function(response, d, a){
					
					jQuery('body .showmessage').remove();
					var html='<div class="showmessage">Server Error.</div>';
					jQuery('body').append(html);
					setTimeout(function(){jQuery('.showmessage').slideUp();},5000); 
				 } 
			   });
		}
	});
	jQuery("#editform").on('submit',(function(e) {
		var url=siteurl+'/api/jobs/updaterecord2';
		var noerror=true;
		var customer_id=jQuery('#customer_id').val();
		var customer_full_name=jQuery('#customer_full_name').val();
		if(jQuery.trim(customer_full_name)==''){
			jQuery('#customer_full_name').addClass('error');
			noerror=false;
		}
		var contact_fname=jQuery('#contact_fname').val();
		if(jQuery.trim(contact_fname)==''){
			jQuery('#contact_fname').addClass('error');
			noerror=false;
		}
		var contact_lname=jQuery('#contact_lname').val();
		/*if(jQuery.trim(contact_lname)==''){
			jQuery('#contact_lname').addClass('error');
			noerror=false;
		}*/
		var contact_email=jQuery('#contact_email').val();
		if(jQuery.trim(contact_email)==''){
			jQuery('#contact_email').addClass('error');
			noerror=false;
		}
		var address=jQuery('#address').val();
		if(jQuery.trim(address)==''){
			jQuery('#address').addClass('error');
			noerror=false;
		}
		e.preventDefault();
		if(noerror){
			jQuery.ajax({
				url: url,
				type: "POST",
				data:  new FormData(this),
				contentType: false,
				cache: false,
				processData:false,
				success: function(data)
				{
					if(parseInt(data)){
						window.location='job.html?job_id='+data+'&newjob=1';
					}
					else{
						jQuery('.errormsg').html(data);
					}
				},
				error: function() 
				{
				} 	        
		   });
		}
	}));
	jQuery('.savejob').click(function(){
		jQuery("#editform").submit();
	});
	localStorage.setItem('gotopage', 'my-schedule.html');
	
});

</script>
</body>
</html>